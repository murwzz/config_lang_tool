# config_tool (вариант №11)

Инструмент командной строки для учебного конфигурационного языка.
Читает входной текст из файла и печатает результат в формате JSON в стандартный вывод.

В проекте используется специализированный инструмент синтаксического разбора: **Lark** (парсер/грамматика).

## Синтаксис учебного языка

### Многострочные комментарии
Комментарии можно вставлять где угодно. Они игнорируются парсером.

```
#|
Это многострочный
комментарий
|#
```

### Имена (идентификаторы)

```
[_a-z]+
```

### Строки
Строки в двойных кавычках:

```
"это строка"
```

(поддерживаются стандартные escape-последовательности как в JSON/ Python строках: `\n`, `\"` и т.д.)

### Числа
Поддерживаются числа с необязательной десятичной точкой и необязательной экспонентой:

- `10`
- `10.5`
- `.5`
- `1e3`
- `.5E+3`
- `-2.0e-2`

### Массивы
В круглых скобках, элементы разделяются запятыми:

```
( значение, значение, значение )
```

Значение может быть числом, строкой, массивом (вложенность разрешена) или ссылкой на константу.

### Объявление константы (на этапе трансляции)

```
var имя значение
```

### Использование константы (на этапе трансляции)

```
^[имя]
```

Результатом вычисления является значение соответствующей константы.

## Командная строка

### Запуск через установленный скрипт
После установки:

```bash
config-tool --input examples/shop.cfg
```

### Запуск без установки
Из корня проекта:

```bash
python -m config_tool --input examples/shop.cfg
```

Параметры:
- `--input` — путь к входному файлу (обязательный)
- `--pretty` — красивый вывод JSON (с отступами)

## Описание модулей и функций

### `config_tool/parser.py`
- `parse_config(text: str) -> dict`  
  Парсит текст учебного языка и возвращает Python-словарь (после вычисления констант).

### `config_tool/cli.py`
- `main()`  
  Читает аргументы командной строки, загружает файл, вызывает `parse_config`, печатает JSON.

### `config_tool/errors.py`
- `ConfigToolError` — базовая ошибка инструмента.
- `ConfigSyntaxError` — ошибка синтаксиса (обёртка над ошибками Lark).
- `ConfigSemanticError` — семантические ошибки (необъявленная константа, циклы).

## Сборка/запуск тестов

Установка зависимостей (пример):

```bash
python -m venv .venv
source .venv/bin/activate
pip install -e ".[dev]"
```

Запуск тестов:

```bash
pytest -q
```

## Примеры использования

### Пример 1: интернет-магазин (`examples/shop.cfg`)
Вход:

```
#| конфиг магазина |#
var currency "RUB"
var tax .2E+0
var prices ( 199.0, 249.5, 300, ( 10, 20, 30 ) )
var result ( ^[currency], ^[tax], ^[prices] )
```

Запуск:

```bash
python -m config_tool --input examples/shop.cfg --pretty
```

Вывод (JSON):

```json
{
  "currency": "RUB",
  "tax": 0.2,
  "prices": [199.0, 249.5, 300.0, [10.0, 20.0, 30.0]],
  "result": ["RUB", 0.2, [199.0, 249.5, 300.0, [10.0, 20.0, 30.0]]]
}
```

### Пример 2: учебный конфиг “курс” (`examples/course.cfg`)
Вход:

```
var title "Python basics"
var weeks 12
var lessons ( "intro", "types", "loops", ( "functions", "modules" ) )
var meta ( ^[title], ^[weeks] )
```

Запуск

python -m pytest

